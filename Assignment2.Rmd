---
title: "Assignment 2 - Team Project"
author: "Lisa Pizzol and Blake Ellison"
date: "`r Sys.Date()`"
output:
  bookdown::html_document2
---


```{r Section 1, message=FALSE, warning=FALSE, include=FALSE}
#Loading Libraries
library(rmarkdown)
library(bookdown)
library(knitr)
library(tidyverse)
library(readxl)
library(kableExtra)
library(plotly)
library(scales)

# read in data and basic tidy
population_raw <- read_excel("Data/WPP2022_GEN_F01_DEMOGRAPHIC_INDICATORS_COMPACT_REV1 (1).xlsx")

colnames(population_raw)<-population_raw[12,]

population <- population_raw[-c(1:12),] 

```

# - Data Description:
The data used is from the United Nations, 2022, and can be found at [World population prospects - population division](https://population.un.org/wpp/). It contains Population, Fertility, Mortality and Migration estimates for 237 countries and/or regions from 1950 to 2021. Only the following selected variables listed in Table 1.1 have been used in this assignment. 

```{r data1, echo=TRUE, message=FALSE, warning=FALSE}
# select only relevant columns and rows
pop_descrip<-select(population,c(3,9,11,12,14,15,17) ) %>%
  filter(Type %in% c("World","Region"))

```


```{r data2, echo=TRUE, message=FALSE, warning=FALSE}
# create list of variables
names_data<-(names(pop_descrip))

# create list of data types
data_type = c("Categorical","Categorical","Numerical","Numerical","Numerical", "Numerical","Numerical")

# create list of detailed information
further_information = c("Contains the following categories: World, Africa, Asia, Europe, Latin America and the Caribbean, Northern America, and Oceania.", "Contains the following information: World and Region","Contains years from 1950 to 2021", "Contains the population number in Thousands as of January", "Contains the Male Population in July in thousands", "Contains the Female Population in July in thousands","Contains the Ratio males per 100 females in July")

#join data sets together
names_data_final<-cbind(names_data,data_type,further_information)

# table of variable information, including column names and caption for table
kable(names_data_final,caption = "Variable Information.", col.names = c('Names','Data Type','Further Information')) %>%
  kable_styling()
```

This filtered data set contains `r ncol(pop_descrip)` variables. An outline of the variable types and information is presented above in Table 1.1. There are `r nrow(pop_descrip)` observations in this filtered data set which contain population values for each year for Global and the Regions only. 

# - World and Continent Population Changes:
## Relative Changes in Population:
Table 2.1 shows the  population (in thousands) for the World and the Regions in 1950 and 2021 and the Relative Population Change between these two years as a percentage.

```{r data3, echo=TRUE, message=FALSE, warning=FALSE}
# select only relevant columns and rows
pop1<-select(population,c(3,9,11,12) ) %>%
  filter(Type %in% c("World","Region"))

# change column types to numerical 
pop1$Year<-as.numeric(pop1$Year)
pop1$`Total Population, as of 1 January (thousands)`<-as.numeric(pop1$`Total Population, as of 1 January (thousands)`)

# creating data set including relative difference
relative_diff<-filter(pop1,Year %in% c(1950,2021)) %>%
  pivot_wider(names_from = Year,values_from = 'Total Population, as of 1 January (thousands)') %>%
  mutate('Relative Difference (%)'= ((`2021`-`1950`)/`1950`)*100)

# Adjust to Title Case for table
relative_diff$`Region, subregion, country or area *` <- str_to_title(relative_diff$`Region, subregion, country or area *`)

# creating table of relative difference data
kable(relative_diff,caption = "Relative Population Change of the World and Region populations from 1950 to 2021.", digits = 0) %>%
  kable_styling()
```

From Table 2.1  the Worlds Relative Population Change between 1950 and 2021 is 218%. The table also indicates that all regions have had an increase too. The region with the greatest population change is Africa with an increase of 512%. Europe is the lowest region with an increase of 36%. 

## World Population Growth between 1950 and 2021:
Figure 2.1 shows the World population from 1950 to 2021. In blue is the population values at each year, while in orange is a linear regression line for this data.

```{r data4, echo=TRUE, message=FALSE, warning=FALSE, fig.cap = "The World Population in January (measured in thousands) from 1950 to 2021.",out.width='100%',out.height='100%'}

# filter for world data only
world<-filter(pop1, Type == 'World') 

# change column names to make graphing easier 
colnames(world)[4] = "Population"

# graph a scatter graph with regression line
p<-ggplot(world,aes(x=Year, y=Population))+geom_point(color="#2375b3")+
  
  # add regression line
  geom_smooth(method = 'lm', se = FALSE,color = "#b36123")+
  
  # show axis line clearly
  theme(axis.line = element_line(linetype = 'solid'))+
  # change y-axis label
  labs(y="World Population Values in January (measured in thousands)")+
  # change y scale numbers from scientific to numeric
  scale_y_continuous(labels = label_number())

# add hover over and ensure graph is displayed
pp <- ggplotly(p) 
pp
```
In Figure 2.1 the World Population has a steady increase from 1950 to 2021. This increase is linear, with the population values being slightly above the regression line in the 1950s and from 2010 onwards.

## Population Growth in the Regions from 1950 to 2021:
Figure 2.2 shows the population numbers in thousands in the regions from 1950 to 2021. All regions have a linear regression fitted to their data in black. Each region has a different y-axis due to their varied population sizes.

```{r data5, echo=TRUE, message=FALSE, warning=FALSE, fig.cap = "The Region Populations in January (measured in thousands) from 1950 to 2021.",out.width='100%',fig.height=12.5}

# get region data only
region<-filter(pop1, Type == 'Region') 

# change column names 
colnames(region)[4] = "Population"
colnames(region)[1] = "Region"

# graph a scatter graph including regression line
p<-ggplot(region,aes(x=Year, y=Population, color= Region))+geom_line(size=1.5)+
  
  # add linear regression line
  geom_smooth(method = 'lm', se = FALSE, colour = '#353935',size =0.5)+
  
  # show axis line clearly
  theme(axis.line = element_line(linetype = 'solid'))+
  # change y-axis label
  labs(y="Region Population Values in January (measured in thousands)")+
  # change y scale numbers from scientific to numeric
  scale_y_continuous(labels = label_number())+
  
  # graph each region on a separate graph, ensure y-scale is free
  facet_wrap(~Region, scales ="free",ncol=2)

# add hover over for further information and ensure graph is displayed
pp<-ggplotly(p) %>%
  
  # change position of legend
  layout(legend=list(orientation='h'))
pp
```

An increase in population across all regions is observed in Figure 2.2, however the following further observations are also seen:

- **Africa** - the population does not follow a linear regression line and is growing at a much faster rate than all other regions.
- **Asia** - the population follows a linear regression from 1960 with an increased growth rate before this.
- **Europe** - does not follow a  linear regression. From the 1990s a halt in growth occurs until the late 2000's when a small rate of increase in population occurs.
- **Latin American and the Caribbean** - the population follows a linear regression except in the early 1950s where the population is higher than the linear regression.
- **Northern America** - the population follows a linear regression but  with a slight deviation from this line in the late 1980s to the early 1990s. 
- **Oceania** - does not follow the linear regression line. 
Further analysis of the data for Africa, Europe and Oceania was not conducted to determine their actual regression type but could be an extension beyond this assignment. 


# - Changes in Sex Proportions Across the Continents and World:

Table 3.1 shows the population of the sexes (in thousands) across multiple continents and the World. Listed is both the raw numbers of Male and Female in 1000s as well as the ratio of Male to Female in a magnitude of Males to 100 Females.

```{r dataa, echo=TRUE, message=FALSE, warning=FALSE}
# select only relevant columns and rows for sex comparisons, original data from Lisa pull
# Filter for World and Continents

sex1<-select(population,c(3,9,11,14,15,17) ) %>%
  filter(Type %in% c("World","Region"))

# Rename columns for ease of use
colnames(sex1)[1] = "Area"
colnames(sex1)[4] = "Male_Pop_Thousands"
colnames(sex1)[5] = "Female_Pop_Thousands"
colnames(sex1)[6] = "Sex_Ratio"

# Change columns to numeric
sex1$Year <- as.numeric(sex1$Year)
sex1$Male_Pop_Thousands <- as.numeric(sex1$Male_Pop_Thousands)
sex1$Female_Pop_Thousands <- as.numeric(sex1$Female_Pop_Thousands)
sex1$Sex_Ratio <- as.numeric(sex1$Sex_Ratio)
```

``` {r include=FALSE}

# Change area label to title case
sex1$Area <- str_to_title(sex1$Area)
```

``` {r include=FALSE}
# Calculate the averages for each Area value
averages <- aggregate(cbind(Male_Pop_Thousands, Female_Pop_Thousands, Sex_Ratio) ~ Area, data = sex1, FUN = mean)

averages$Male_Pop_Thousands<-round(averages$Male_Pop_Thousands, digits = 2)
averages$Female_Pop_Thousands<-round(averages$Female_Pop_Thousands, digits = 2)
averages$Sex_Ratio<-round(averages$Sex_Ratio, digits = 2)

# create a new data frame using the averages with the Area values
averages_df <- data.frame(
  Region = averages$Area,
  `Avg_Male_Pop_Thousands` = averages$Male_Pop_Thousands,
  `Avg_Female_Pop_Thousands` = averages$Female_Pop_Thousands,
  `Males_Per_100_Female` = averages$Sex_Ratio
)

```
``` {r INCLUDE=TRUE}

kable(averages_df,caption = "Male and Female Differences Across the Regions", digits = 0) %>%
  kable_styling()

```

Within this data set is `r ncol(sex1)` columns. Missing above is the 'Year' column. There are `r nrow(sex1)` records in this  data set. Each row accounts for a single years' measurement for the associated region.

## - Changes Across the World:

Figure 3.2 shows the World sexes distribution from 1950 to 2021.

``` {r}
# filter for world data only
world <- filter(sex1, Type == 'World') 

# Create plot
p<-ggplot(data = world, aes(x = Year)) +
  
  # Add blue line for males
  geom_line(aes(y = Male_Pop_Thousands), colour = "#2768A4") +
  
  #add pink line for females
  geom_line(aes(y = Female_Pop_Thousands), colour = "#B85887") +
  
  # chane the y label
  labs(y="Population Count") + 
  
  # Make axis lines solid
  theme(axis.line = element_line(linetype = 'solid')) + 
  
  # Make y scale continuous rather than scientific notation
  scale_y_continuous(labels = label_number())

pp <- ggplotly(p) 
pp
  
```